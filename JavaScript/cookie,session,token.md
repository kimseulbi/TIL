# cookie,session,token

## 웹에서 쿠키와 세션 (Cookie & Session)

connectionless하고 stateless한 특성 때문에 서버와 클라이언트가 통신을 할 때 마다 서버는 클라이언트가 누구인지 인증을 계속해야하고, 이 점을 보완하기 위해 쿠키와 세션이 사용되었습니다.

### 비연결지향(Connectionless)

- 클라이언트가 요청을 한 후 응답을 받으면 그 연결을 끊어 버리는 특징
- HTTP는 먼저 클라이언트가 request를 서버에 보내면, 서버는 클라이언트에게 요청에 맞는 response를 보내고 접속을 끊는 특성이 있다.

### 상태정보유지안함(Stateless)

- 통신이 끝나면 생겼던 상태를 유지하지 않는 특징
- 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보는 유지하지 않는 특성이 있다.
- 재앙메일 볼라고 로그인하고 들어갔는데 메일 한통 열어 볼 때마다 로그인 해야 함.

## 쿠키

클라이언트(브라우저)에 저장되는 **작은 기록 정보 파일**입니다. 이 작은 데이터 파일은 이름 + 값 형태로 저장됩니다. 웹 브라우저는 쿠키를 저장하기 위한 저장소를 가지고 있는데, 서버가 응답을 통해 브라우저에게 이 쿠키를 저장해 놓아라하고 지시하면, 브라우저에서는 받은 쿠키를 저장합니다.

![](https://nesoy.github.io/assets/posts/20170317/2.PNG)

### 쿠키 종류

| 이름                            | 특징                                                                                                                                                                                               |
| ------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Session Cookie (세션 쿠키)      | 만료시간(Expire date)이 없는 쿠키로, 메모리에 저장되며 디스크에 기록되지 않습니다. 만료일이 없으므로 브라우저 종료시 쿠키는 삭제됩니다.                                                            |
| Persistent Cookie (영구적 쿠키) | 만료일이 지정되어 유효 기간 내에 유지되는 쿠키(예를 들어 Max-Age 1년)로, 디스크에 파일로 저장되어 브라우저 종료와 관계없이 보관되고 사용됩니다. 지정된 만료일이 되면 디스크에서 쿠키가 제거됩니다. |
| Secure Cookie                   | secure 옵션이 적용된 HTTPS에서만 사용되는 쿠키입니다. 쿠키의 정보가 암호화 되어 전송됩니다.                                                                                                        |
| Third-Party Cookie              | 방문한 도메인과 다른 도메인의 쿠키입니다. 보통 광고 베너 등을 관리할 때 유입 경로를 추적하기 위해 사용. (명시를 해야합니다.)                                                                       |

**속성을 여러개를 사용할수 있습니다.**

### 쿠키(Cookie) 단점

- 한 클라이언트에 300개, 하나의 도메인당 20개의 값만 가질 수 있으며, 하나의 쿠키값은 4KB까지 저장할 수 있습니다.
- 쿠키에 대한 정보를 매 헤더(Http Header)에 추가하여 보내기 때문에 상당한 트랙픽을 발생시킵니다.
- 쿠키가 담긴 HTTP 요청이 도중에 노출되면 개인 정보가 그대로 노출될 수 있는 위험이 있습니다.

## 세션

쿠키를 보안적이슈를 해결하기 위해 등장 했습니다.

세션은 결국엔 쿠키를 사용하고 있지만, 사용자 정보 파일을 브라우저에 저장하는 쿠키와 달리 세션은 서버 측에서 관리한다는 점에서 크게 다릅니다. 서버에서는 클라이언트를 구분하기 위해 세션 ID를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 이 세션 ID를 통해 인증 상태를 유지합니다.

![](https://t1.daumcdn.net/cfile/tistory/994BEA345B53368401)

1. 사용자가 로그인 페이지에 id / pw를 입력하고 로그인 버튼 클릭
1. 서버에서 사용자의 로그인 정보를 확인하고 존재하는 사용자면 서버 메모리에 유일한 Session ID를 생성하고 사용자 id와 매핑 정보를 저장
1. 로그인 요청에대한 응답에 Set-Cookie를 통해 새로 발행한 Session Id를 함께 보냄. (이 때 쿠키 이름은 JSESSIONID이다.) 요즘은 토큰으로 사용을 많이 함.
1. 클라이언트는 해당 쿠키 저장.
1. 해당 서버에 요청을 할 때마다 이 쿠키를 함께 보내 갖고있는 세션 ID 값을 서버에 전달.
1. 요청시 마다 서버는 Request Header의 쿠키 정보(세션 ID)를 확인하고 세션 ID와 매핑되는 id의 사용자로 인식.(로그인 인증 상태 유지)

### 쿠키와 세션의 차이점

쿠키와 세션은 사용자의 정보를 저장해서 매 요청시 해당 정보를 요청과 함께 전송해 사용자가 지속적으로 로그인 중이라는 사실을 서버에게 알려주는 역할을 함에 있어서는 비슷하며, 동작 원리도 비슷합니다. 그 이유는 세션도 결국엔 쿠키를 사용하기 때문입니다.

하지만 가장 큰 차이점은 사용자의 기록 정보가 저장되는 위치입니다. 쿠키는 서버의 자원을 전혀 사용하지 않으며, 세션은 서버의 자원을 사용합니다. 이 외, 아래와 같은 차이점들도 있습니다.

- 쿠키는 클라이언트 로컬에 저장되기 때문에 변질되거나 request에서 스나이핑 당할 우려가 있어서 보안에 취약하지만 세션은 쿠키를 이용해서 sessionid 만 저장하고 그것으로 구분해서 서버에서 처리하기 때문에 비교적 보안성이 좋다.

- 세션은 서버의 처리가 필요하기 때문에, 요청 속도는 쿠키가 세션보다 더 빠릅니다.

- 쿠키도 만료시간이 있지만 파일로 저장되기 때문에 브라우저를 종료해도 계속해서 정보가 남아 있을 수 있고 만료기간을 넉넉하게 잡아두면 쿠키삭제를 할 때까지도 유지 될 수 있다. 반면에 세션도 만료시간을 정할 수 있지만 브라우저가 종료되면 만료시간에 상관없이 삭제된다.

> 쿠키와 세션 vs 캐시 : 캐시는 이미지나 css, js파일 등을 사용자의 브라우저에 저장해 자원이 아껴지는 것이고, 쿠키와 세션은 사용자가 서버와 추가적인 인증없이 계속해서 인증된 사용자로서 서버에 요청을 보낼 수 있게끔 해주는 것입니다.

## 토큰

JWT는 세션&쿠키와 함께 사용자의 인증을 책임지는 대표 주자입니다. 이는 Json Web Token의 약자로 사용자 인증에 필요한 정보들을 암호화시킨 토큰을 뜻합니다.

요즘 웹 / 모바일 웹 어플리케이션들이 부흥하게 되면서, 이런 방식의 인증 시스템은 문제를 보이기 시작했습니다. 그 문제점이란,

**저장 공간** 서버 과부하 문제

**확장성** 서버 확장을 불편함.

**CORS**는 여러 도메인을 연결 해주는데 쿠키는 단일도메인만 가능하기 때문에

### JWT 특징

- JSON Web Token (JWT) 은 웹표준 (RFC 7519) 으로서 두 개체에서 JSON 객체를 사용하여 가볍고 자가수용적인 (self-contained) 방식으로 정보를 안전성 있게 전달해줍니다.

- 수많은 프로그래밍 언어에서 지원됩니다. JWT 는 C, Java, Python, C++, R, C#, PHP, JavaScript, Ruby, Go, Swift 등 대부분의 주류 프로그래밍 언어에서 지원됩니다.

- 자가 수용적 (self-contained) 입니다. JWT는 필요한 모든 정보를 자체적으로 지니고 있습니다. JWT 시스템에서 발급된 토큰은, 토큰에 대한 기본정보, 전달 할 정보 그리고 토큰이 검증 됐다는것을 증명해주는 signature 를 포함하고있습니다.

- 쉽게 전달 될 수 있습니다. JWT 는 자가 수용적이므로 두 개체 사이에서 손쉽게 전달 될 수 있습니다. 웹서버의 경우 HTTP의 헤더에 넣어서 전달 할 수도 있고, URL의 파라미터로 전달 할 수도 있습니다.

## 쿠키와 웹스토리지

### 웹스토리지 (web storage)

웹스토리지는 HTML5에서 추가된 저장소로, 로컬 스토리지(localStorage)와 세션 스토리지(sessionStorage)로 나눠집니다. 쿠키와 마찬가지로 키-밸류 스토리지의 형태입니다.

두 스토리지 모두 보완에 있어서는 크게 강력한 편이 아니기 때문에, 정말 중요한 정보를 담아두기에는 적절하지 않다.(고 생각합니다

## JWT 토큰은 어디에 저장하는게 좋을까?

[JWT 토큰은 어디에 저장하는게 좋을까?](http://lazyhoneyant.blogspot.com/2016/08/jwt.html)

### XSS(cross-site scripting)

XSS 는 쉽게 말하면 해커가 자바스크립트 코드를 웹페이지에 심어 사용자의 정보를 탈취하는 종류의 공격이다. 일반적으로 웹 어플리케이션들은 사용자로부터 데이터를 입력받게 되는데 이 데이터에 해커가 자바스크립트 코드를 심어 놓을 수 있는 것이다. 쉽게 생각해 게시판에 글을 쓴다고 생각해보자. 글 내용에 해커가 자바스크립트 코드를 심어 놓고 사용자들이 이 글을 보면서 동시에 자바스크립트 코드가 실행되어 해커가 원하는 것을 얻을 수 있게 된다. 물론 이런 공격은 많이 알려져 있기 때문에 대부분에 이와 같은 입력은 사전에 필터링을 통해 차단한다
